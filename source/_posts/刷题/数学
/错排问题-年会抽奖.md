---
title: '错排问题:年会抽奖'
thumbnail: 'http://static.come2rss.xyz/尼尔机械.jpg'
toc: true
top: 10
date: 2021-03-10 18:07:43
tags:
categories:
---



所谓错排问题就是N个1~N数字的序列都恰好不在对应位上，比如序列`3 1 2 `。

### 题目：年会抽奖

今年公司年会的奖品特别给力，但获奖的规矩却很奇葩：

1. 首先，所有人员都将一张写有自己名字的字条放入抽奖箱中；
2. 待所有字条加入完毕，每人从箱中取一个字条；
3. 如果抽到的字条上写的就是自己的名字，那么“恭喜你，中奖了！”
   现在告诉你参加晚会的人数，请你计算有多少概率会出现无人获奖？

<!-- more -->



### 思路

首先所有数字可能的排列顺序为$n!$，我们只需要求出所有可能出现的错排书就行。

采用排除法，记$a_i$是$i$个数字错排的数量，

通过并集计算公式，排除掉$k,  1 <= k <= n $个数字排列正确排列的所有情况
$$
P(A) =  n! - n * a_{n -1} + n * (n -1) /2 * a_{n-2} ....  \\\\ 
= n! - n * (n - 1)! + \frac{n!}{2!} - \frac{n!}{3!} ....
=\frac{n!}{2!} - \frac{n!}{3!} ....
= \sum_{k=2}^{n}{(-1)^k} \frac{n!}{k!}
$$
上式中，1个数字排列正确的序列保护了2个数列排列正确的情况，2个数字排列正确的序列保护了3个数列排列正确的情况，所以可以使用并集公式。



换一种想法：

可以观察到，错排的序列`3 4 1 2`有位置对换的数字2和4，如果固定这两个数字，剩下的数字进行错排有`3 1`。可以观察到序列数量减少了，不由有递推的味道。

那如果最后一个数字没有与位置对换呢？如`2 3 4 1 `，为了同样获取`n-1`个可以错排的数据（数据和坑位可以一一对应），把`4`排除去，我们可以把第四个数字看成被`4`占据的第三位，构成了`2 3 1`。

公式化一下：

由题意`a1=0`，`a2=1`，当`n≥3`时，在错排中`n`必不在第`n`位，设`n`放在第`k`位上（`1≤k≤n-1`），则第`n`位上有两种可能：

（1）如果第`n`位上不是`k`，那么把第`n`位看作第`k`位，将`n`以外的`n－1`个数进行错排，错排个数是`an-1`；

（2）如果第`n`位上是`k`，那么除`n`和`k`以外的`n－2`个数的错排是`an-2`，

所以n在第k位上的错排数共有`an-1＋an-2`，由于`k`可取`1、2、3、4、……、n－1`共 `n -1 `种取法，所以`n`个数的错排个数。

所以有递推公式：`an= (n - 1)(an-1 + an-2)`。







