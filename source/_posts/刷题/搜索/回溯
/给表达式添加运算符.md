---
title: 【hard】给表达式添加运算符
thumbnail: 'http://static.come2rss.xyz/尼尔机械.jpg'
toc: true
top: 10
date: 2021-10-16 20:34:02
tags:
categories:
---





#### [282. 给表达式添加运算符](https://leetcode-cn.com/problems/expression-add-operators/)

<!-- more -->

## 思路

hard题真不错，耐。。。。

递归计算机表达式的变形，把式子以数字为单位分割，并枚举中间存在的操作符，递归地搜索所有表达式结果。

其中因为乘法表达式优先级关系，需要记录最新的乘法"因子"（比如`a*b*c`, 或者 `b`）。





## 代码

> 突然想念python的好

```c++

class Solution {
    using ll = long long;
    vector<string> formulas;
    char formula[100]; // 减少字符串拼接消耗
public:
    vector<string> addOperators(string num, int target) {
        constructFormula(num, 0, 0, 0, 0, target);
        return formulas;
    }

    void constructFormula(string num, int sidx, int fidx, ll res, ll preCal, int target) {
        if(sidx == num.size()){
            if(target == res) {
                formula[fidx] = 0;                
                formulas.push_back(string(formula));
            }
            return;
        }
        
        ll x = 0;
        for(int i = sidx; i < num.size(); i++) {         
            int pass = 0;
            x = x * 10 + c2i(num[i]);
            //cout << x << endl;
            if(sidx == 0) {
                for(int j = sidx; j <= i; j++) formula[fidx + j - sidx] = num[j];
                pass = i - sidx + 1;
                constructFormula(num, sidx + pass, fidx + pass, res + x , x, target);
            } else {        
                for(int j = sidx; j <= i; j++) formula[fidx + 1 + j - sidx] = num[j];
                pass = i - sidx + 1;
                
                formula[fidx] = '+';
                constructFormula(num, sidx + pass, fidx + 1 + pass, res + x , x, target);

                formula[fidx] = '-';
                constructFormula(num, sidx + pass, fidx + 1 + pass, res - x, -x, target);

                formula[fidx] = '*';
                constructFormula(num, sidx + pass, fidx + 1 + pass, res - preCal + preCal * x,  preCal * x, target);
            }
            if(x == 0) break; // 对于单个数字零是无法其他数字的前导的，直接作为一个数字`0`。
        }
        
    }

    inline
    int c2i(char c) {
        return c - '0';
    }
};
```