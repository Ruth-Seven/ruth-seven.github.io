---
title: 堆算法和堆排序
thumbnail: 'http://static.come2rss.xyz/尼尔机械.jpg'
toc: true
top: 10
tags:
categories:
date: 2020-08-07 12:24:34
---

## 堆排序

```c++
#include<iostream>
#include<cstdio>
#include<vector>
#include<algorithm>
#include<string>
using namespace std;
vector<int> a, b;
int n;
void adjustDown(vector<int> &arr, int x, int len){
    for(int p = 2 * x; p <= len; p *= 2){
        if(p < len  && arr[p] < arr[p+1]) p++;
        if(arr[x] > arr[p]) break;
        swap(arr[x], arr[p]);
        x = p;
    }
}
int main(){
    cin >> n;
    a.resize(n + 1);
    b.resize(n + 1);
    for(int i = 1;i <= n; i++) cin >> a[i];
    for(int i = 1;i <= n; i++) cin >> b[i];
    int p = 1, ch;
    while(p < n && b[p] <= b[p + 1]) p++;
    for(ch = p + 1; ch <= n && a[ch] == b[ch]; ch++);
    if(ch == n + 1){
        cout << "Insertion Sort\n";
        sort(a.begin() + 1, a.begin() + 2 + p);
    }else{
        cout << "Heap Sort\n";
        int k = n;
        while(k > 0 && b[k] > b[1]) k--;
        swap(b[1], b[k]);
        adjustDown(b, 1, k - 1);
        a = b;

    }
    for(int i = 1; i <= n; i++)
        if(i == n) printf("%d\n", a[i]);
        else  printf("%d ", a[i]);
}
```

## 完全堆排序

```c++
#include<iostream>
#include<cstdio>
using namespace std;

const int MAXN = 1e3;
int heap[MAXN] = {0,3,14,7,12,13,4,5,20};
int n = 8;
///! down
void downAdjust(int p,int len){
    for(int x = p * 2; x <= len; x += x){
        if(x < len && heap[x] < heap[x + 1]) x++;
        if(heap[x] < heap[p]) break;
        swap(heap[x], heap[p]);
        p = x;
    }
}
//    for(int i=1;i<=n/2;i++)
    //! 叶子的一个下标是 n/2向下取整+1
    //! 必须从底部开始调整，不然不能保持之前的子堆的有序性质
void buildHeap(){
    for(int i=n/2; i>=1; i--)
        downAdjust(i,n);
}
///!delete element
void deleteTop(){
    heap[1] = heap[n--];//! n--
    downAdjust(1,n);
}
///!!!up
void upAdjust(int p, int len){
    for(int x = p /2 ; x >= 1; x /= 2){
        if(heap[x] > heap[p]) break;
        swap(heap[x], heap[p]);
        p = x;
    }
}
void insert(int x)
{
    heap[++n] = x;
    upAdjust(n,n);
}
void show()
{
    for(int i=1; i<=n; i++)
        cout<<heap[i]<<" ";
    cout<<"\n";
}
///! head sort
void headSort(int n)
{
    buildHeap();
    for(int i=n; i>=2; i--)
    {
        swap(heap[1],heap[i]);
        downAdjust(1,i-1);//!! heap only have n-1 elements;
    }
}
int main()
{
    show();
    buildHeap();
    insert(25);
    show();
    headSort(n);
    show();
}
```