---
title: 树状数组
thumbnail: 'http://static.come2rss.xyz/尼尔机械.jpg'
toc: true
top: 10
tags:  
categories:
date: 2020-10-15 09:54:18
---




# [树状数组](https://oi-wiki.org/ds/fenwick/)

对`A[i]`数组进行前前缀和的维护的时更新成了一个大难题，树状数组提供`O(logn)`的复杂度更新速度。`C[i]`所能管理的`A[i]`数字如下图所示，如果查询7的前缀和，则需要计算`C[7] + C[6] + C[4]`。

<!-- more -->

可以发现每次下标的最后一个`1`都消失了, 而这个`1`和之后的零可以用`lowbit`函数计算。巧妙的是，依次得到`p`末尾少一的数，和依次自增末尾1和零组成的数，分别是遍历求和数的值，和该数节点的祖先。由此我们可以利用lowbit来计算sum和建树。

![img](http://static.come2rss.xyz/fenwick1.png)



```c++

# define lowbit(x)  (x) & (-x)

void add(int p, int x){
	while(p < n){
        c[p] += x;
        p += lowbit(p);
    }    
}

int gsum(int p){
    int res = 0;
    while(p >=1){
        res += c[p];
        p -= lowbit(p);
    }
    return res;
}

//o(n)建树
void build(int a[], int n){
    for(int i = 0;i < n; ++i){
        c[i] += a[i];
        if(i + lowbit(i) < n) c[i + lowbit(i)] += a[i];
    }   
}
//区间计算和
int add1(int l, int r ){
    return gsum(r) - gsum(l - 1);
}

```

[参考资料](https://oi-wiki.org/ds/fenwick/)